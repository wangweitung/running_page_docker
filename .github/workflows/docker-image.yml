name: è‡ªåŠ¨åŒ–æ„å»º Running Page Docker é•œåƒ

on:
  push:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      app_type:
        description: 'è¦æ„å»ºçš„å¹³å°ç±»å‹ï¼ˆNRC/Garmin/Garmin-CN/Strava/Nike_to_Strava/Keepï¼‰'
        required: true
        default: 'Keep'
  # æ–°å¢ï¼šå®šæ—¶è§¦å‘å™¨ï¼ˆæ¯å¤©ä¸œå…«åŒº8:00è¿è¡Œï¼Œå¯¹åº”UTC 0:00ï¼‰
  schedule:
    - cron: '0 0 * * *'

permissions:
  contents: read
  packages: write
  id-token: write

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
      # æºç ä»“åº“åœ°å€
      RUNNING_PAGE_REPO: https://github.com/yihong0618/running_page
      # æºç å…‹éš†åçš„ç›®å½•
      SRC_DIR: ./running_page_src
      # SVGç”Ÿæˆå‚æ•°ï¼ˆå»ºè®®åœ¨GitHub Secretsä¸­é…ç½®ï¼‰
      #TITLE: ${{ secrets.RUNNING_PAGE_TITLE || 'My Running Page' }}
      #ATHLETE: ${{ secrets.RUNNING_PAGE_ATHLETE || 'Runner' }}

    steps:
      # æ–°å¢ï¼šè®¾ç½®Ubuntu runnerç³»ç»Ÿä¸ºæ—¶åŒºä¸œå…«åŒºï¼ˆAsia/Shanghaiï¼‰
      - name: é…ç½®ç³»ç»Ÿæ—¶åŒºä¸ºä¸œå…«åŒº
        run: |
          sudo timedatectl set-timezone Asia/Shanghai
          echo "âœ… ç³»ç»Ÿæ—¶åŒºå·²åˆ‡æ¢ä¸ºï¼š$(date +%Z-%z)"


      - name: ç”Ÿæˆæ—¶é—´æˆ³ï¼ˆå¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼‰
        id: timestamp
        run: |
          # ç”Ÿæˆæ ¼å¼ï¼š20240520143025ï¼ˆå¹´-æœˆ-æ—¥-æ—¶-åˆ†-ç§’ï¼‰
          TS=$(date -u +%Y%m%d%H%M%S)
          echo "ts=$TS" >> $GITHUB_OUTPUT
          # å¯é€‰ï¼šæŠŠæ—¶é—´æˆ³å†™å…¥ç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿åç»­æ­¥éª¤ç›´æ¥ä½¿ç”¨
          echo "IMAGE_TAG_TIMESTAMP=$TS" >> $GITHUB_ENV

      - name: æ£€å‡ºå½“å‰ä»“åº“ä»£ç 
        uses: actions/checkout@v4

      - name: å…‹éš†running_pageæºç ä»“åº“
        run: |
          echo "ğŸ“¥ å¼€å§‹å…‹éš† running_page æºç ä»“åº“"
          git clone ${{ env.RUNNING_PAGE_REPO }} ${{ env.SRC_DIR }}
          # è¿›å…¥æºç ç›®å½•ï¼Œç¡®è®¤Dockerfileå­˜åœ¨
          cd ${{ env.SRC_DIR }}
          find ./assets -name '*[0-9]*' -exec rm -rf {} +
          rm -rf ./assets/mol.svg
          if [ ! -f Dockerfile ]; then
            echo "âŒ æºç ç›®å½•ä¸­æœªæ‰¾åˆ°Dockerfile"
            exit 1
          fi
          echo "âœ… æºç å…‹éš†å®Œæˆï¼ŒDockerfileå­˜åœ¨"


          echo "ğŸ“¥ å¼€å§‹åŠ å…¥ç”Ÿæˆmonthoflife svgä»£ç "
          # æ ¸å¿ƒå‘½ä»¤ï¼šåŒ¹é…ç›®æ ‡è¡Œï¼Œæ·»åŠ --with-gpxå‚æ•°
          sed -i 's/\(python3 run_page\/keep_sync.py ${keep_phone_number} ${keep_password}\);/\1 --with-gpx;/' Dockerfile
          echo "âœ… ä¿®æ”¹keepæ„å»ºå‘½ä»¤å®Œæˆ"

        

            # è„šæœ¬åŠŸèƒ½ï¼š
          # 1. ç»™Dockerfileçš„RUNå‘½ä»¤ä¸­æ–°å¢åŸå§‹monthoflifeè¡Œã€å¤šè¿åŠ¨ç±»å‹molè¡Œï¼ˆè‡³cyclingç±»å‹ï¼‰
          # 2. è¡¥å…¨æ‰€æœ‰éæœ€åä¸€è¡Œçš„ç»­è¡Œæ–œæ ï¼ˆ\ï¼‰ï¼Œç¡®ä¿Dockerfileè¯­æ³•åˆè§„
          # 3. ä¿ç•™æ ¼å¼ç»Ÿä¸€ï¼šæ‰€æœ‰æ–°å¢è¡Œä»¥"  &&"å¼€å¤´ï¼Œå¼•å·æ ¼å¼ã€ç¼©è¿›ä¸ç›®æ ‡ç»“æœä¸€è‡´
          # 4. åç»­è‡ªåŠ¨æ›¿æ¢è‡ªå®šä¹‰å‚æ•°ï¼ˆæœ€å°è·ç¦»ã€ç‰¹æ®Šè·ç¦»ã€å‡ºç”Ÿå¹´æœˆã€è¿åŠ¨å‘˜åç§°ï¼‰
          # æ³¨æ„äº‹é¡¹ï¼š
          # - Linuxç¯å¢ƒç›´æ¥è¿è¡Œï¼ŒmacOSç¯å¢ƒéœ€å°†sed -iæ”¹ä¸ºsed -i ''
          # - ç»­è¡Œç¬¦\å¿…é¡»æ˜¯è¡Œå°¾æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œåé¢ä¸å¯æœ‰ç©ºæ ¼/åˆ¶è¡¨ç¬¦
          # - ç”Ÿæˆçš„${{env.ATHLETE}}ä¸ºGitHub Actionsç¯å¢ƒå˜é‡ï¼Œä¼šè¢«è‡ªåŠ¨è§£æ

          # å¼€å§‹æ‰§è¡Œæ–°å¢ä»£ç æ“ä½œï¼ˆä»…ä¿ç•™1æ¬¡echoï¼Œé¿å…æ—¥å¿—é‡å¤ï¼‰
          echo "ğŸ“¥ å¼€å§‹åŠ å…¥ç”Ÿæˆmonthoflife svgä»£ç ã€å¤šè¿åŠ¨ç±»å‹molä»£ç å¹¶è¡¥å…¨ç»­è¡Œæ–œæ "

          awk '
          /RUN python3 run_page\/gen_svg.py --from-db --title "my running page" --type grid/ {
              print $0 " \\";  # ç¬¬1è¡Œï¼šgridç±»å‹ï¼Œæ·»åŠ ç»­è¡Œç¬¦
              getline; print $0 " \\";  # ç¬¬2è¡Œï¼šgithubç±»å‹ï¼Œæ·»åŠ ç»­è¡Œç¬¦
              getline; print $0 " \\";  # ç¬¬3è¡Œï¼šcircularç±»å‹ï¼Œæ·»åŠ ç»­è¡Œç¬¦ï¼ˆå»é™¤é‡å¤è¡Œï¼Œç›´æ¥ç»­è¡Œï¼‰
              print "  && python3 run_page/gen_svg.py --from-db --type monthoflife --birth 1989-03 --special-distance 10 --special-distance2 20 --special-color '\''#f9d367'\'' --special-color2 '\''#f0a1a8'\'' --output assets/mol.svg --use-localtime --athlete yihong0618 --title '\''Runner Month of Life'\'' \\";
              print "  && python3 run_page/gen_svg.py --from-db --type monthoflife --birth 1989-03 --special-color \"#f9d367\"  --special-color2 \"#f0a1a8\" --output assets/mol_running.svg --use-localtime --athlete \"${{env.ATHLETE}}\" --title \"Runner Month of Life\" --sport-type running \\";
              print "  && python3 run_page/gen_svg.py --from-db --type monthoflife --birth 1989-03 --special-color \"#f9d367\"  --special-color2 \"#f0a1a8\" --output assets/mol_walking.svg --use-localtime --athlete \"${{env.ATHLETE}}\" --title \"Walker Month of Life\" --sport-type walking \\";
              print "  && python3 run_page/gen_svg.py --from-db --type monthoflife --birth 1989-03 --special-color \"#f9d367\"  --special-color2 \"#f0a1a8\" --output assets/mol_hiking.svg --use-localtime --athlete \"${{env.ATHLETE}}\" --title \"Hiker Month of Life\" --sport-type hiking \\";
              # ä¿®æ­£ï¼šç§»é™¤æœ€åä¸€è¡Œçš„ç»­è¡Œç¬¦\ï¼Œé¿å…Dockerfileè¯­æ³•æŠ¥é”™ï¼ˆæ— æ–°å¢å†…å®¹ï¼Œä»…åˆ é™¤\ï¼‰
              print "  && python3 run_page/gen_svg.py --from-db --type monthoflife --birth 1989-03 --special-color \"#f9d367\"  --special-color2 \"#f0a1a8\" --output assets/mol_cycling.svg --use-localtime --athlete \"${{env.ATHLETE}}\" --title \"Cyclist Month of Life\" --sport-type cycling";
              next;
          }
          1
          ' Dockerfile > Dockerfile.tmp

          # æ›¿æ¢åŸæ–‡ä»¶å¹¶å¤‡ä»½æ—§æ–‡ä»¶
          mv Dockerfile Dockerfile.old
          mv Dockerfile.tmp Dockerfile


          echo "âœ… æ–°å¢æ‰€æœ‰monthoflifeï¼ˆå¤šè¿åŠ¨ç±»å‹ï¼‰ä»£ç +è¡¥å…¨ç»­è¡Œæ–œæ å®Œæˆ"
          cat Dockerfile | grep "circular --use-localtime"

          # æ‰§è¡Œè‡ªå®šä¹‰å‚æ•°æ›¿æ¢
          echo "ğŸ“¥ å¼€å§‹ä¿®æ”¹è‡ªå®šä¹‰è·ç¦»ã€å‡ºç”Ÿå¹´æœˆå’Œè¿åŠ¨å‘˜åç§°"
          sed -i \
            -e '/gen_svg.py/ s/--min-distance [0-9.]\+/--min-distance ${{ secrets.DIS1 }}/g' \
            -e '/gen_svg.py/ s/--special-distance [0-9]\+/--special-distance ${{ secrets.DIS2 }}/g' \
            -e '/gen_svg.py/ s/--special-distance2 [0-9]\+/--special-distance2 ${{ secrets.DIS3 }}/g' \
            -e '/gen_svg.py/ s/--birth 1989-03/--birth ${{ secrets.BIRTH }}/g' \
            -e '/gen_svg.py/ s/--athlete yihong0618/--athlete "$YOUR_NAME"/g' \
            Dockerfile

          # æç¤ºæ‰§è¡Œå®Œæˆ
          echo "âœ… è‡ªå®šä¹‰å‚æ•°ä¿®æ”¹å®Œæˆ"

          echo "âœ… è‡ªå®šä¹‰å‚æ•°ä¿®æ”¹å®Œæˆ"
          echo "ğŸ“¥ å¼€å§‹æ‰“å°å¹¶ç¡®è®¤Dockerfile"
          cat Dockerfile
          echo "âœ… ç¡®è®¤Dockerfileå®Œæˆ"



          echo "ğŸ“¥ å¼€å§‹æ›¿æ¢mapboxtoken"
          # æ ¸å¿ƒä¿®æ”¹ï¼šåŒ¹é…å•å¼•å·åŒ…è£¹çš„ Mapbox Token å­—ç¬¦ä¸²ï¼Œç›´æ¥æ›¿æ¢
          sed -i \
            -e "s/'pk[^']*'/'${{ secrets.MAPBOX }}'/g" \
          ./src/utils/const.ts
          echo "âœ… mapboxtokenæ›¿æ¢å®Œæˆ"



          # æ–°å¢ï¼šä¿®æ”¹ src/static/site-metadata.ts ä¸­çš„å¯¹åº”å­—æ®µï¼ˆæ ¸å¿ƒæ­£ç¡®é€»è¾‘ï¼‰

          echo "ğŸ“¥ å¼€å§‹æ›¿æ¢ site-metadata.ts ä¸­çš„ç«™ç‚¹é…ç½®"
          SITE_METADATA_FILE="./src/static/site-metadata.ts"
          # 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          if [ ! -f "$SITE_METADATA_FILE" ]; then
            echo "âŒ æœªæ‰¾åˆ° $SITE_METADATA_FILE æ–‡ä»¶"
            exit 1
          fi
          # 2. ä½¿ç”¨ | ä½œä¸ºåˆ†éš”ç¬¦ï¼Œé¿å… URL ä¸­çš„ / å†²çª
          sed -i \
            -e "s|siteTitle: 'Running Page'|siteTitle: '${{ secrets.SITEtitle }}'|g" \
            -e "s|siteUrl: 'https://yihong.run'|siteUrl: '${{ secrets.SITEurl }}'|g" \
            -e "s|description: 'Personal site and blog'|description: '${{ secrets.SITEdescription }}'|g" \
            -e "s|url: 'https://github.com/yihong0618/gitblog'|url: '${{ secrets.BLOGurl }}'|g" \
            -e "s|url: 'https://github.com/yihong0618/running_page/blob/master/README-CN.md'|url: '${{ secrets.ABOUTurl }}'|g" \
          "$SITE_METADATA_FILE"
          echo "âœ… site-metadata.ts ç«™ç‚¹é…ç½®æ›¿æ¢å®Œæˆ"

        
      # - name: å®‰è£…Pythonä¾èµ–ï¼ˆç”¨äºç”ŸæˆSVGï¼‰
      #   run: |
      #     echo "ğŸ“¦ å®‰è£…PythonåŠä¾èµ–åŒ…"
      #     sudo apt update && sudo apt install -y python3 python3-pip python3-venv
      #     cd ${{ env.SRC_DIR }}
      #     # å®‰è£…running_pageä¾èµ–
      #     pip3 install -r requirements.txt --user
      #     echo "âœ… Pythonä¾èµ–å®‰è£…å®Œæˆ"

      # - name: æ•°æ®ä¸‹è½½å¹¶ç”ŸæˆSVGå›¾ç‰‡
      #   id: generate-svg
      #   run: |
      #     # è·å–æ„å»ºç±»å‹ï¼ˆæ‰‹åŠ¨è§¦å‘ä¼˜å…ˆï¼Œé»˜è®¤Keepï¼‰
      #     APP_TYPE="${{ github.event.inputs.app_type || 'Keep' }}"
      #     echo "ğŸ“Š å¼€å§‹å¤„ç† ${APP_TYPE} å¹³å°æ•°æ®å¹¶ç”ŸæˆSVG"
          
      #     cd ${{ env.SRC_DIR }}
          
      #     # ç¬¬ä¸€æ­¥ï¼šæ•°æ®ä¸‹è½½ï¼ˆä¸åŒå¹³å°æ‰§è¡Œå¯¹åº”è„šæœ¬ï¼‰
      #     case $APP_TYPE in
      #       Strava)
      #         python3 run_page/strava_sync.py  ${{ secrets.STRAVA_CLIENT_ID }} \
      #            ${{ secrets.STRAVA_CLIENT_SECRET }} \
      #            ${{ secrets.STRAVA_REFRESH_TOKEN }}
      #         ;;
      #       NRC)
      #         python3 run_page/nrc_download.py --nike_refresh_token ${{ secrets.NIKE_REFRESH_TOKEN }}
      #         ;;
      #       Garmin)
      #         python3 run_page/garmin_download.py --secret_string ${{ secrets.GARMIN_SECRET_STRING }}
      #         ;;
      #       Garmin-CN)
      #         python3 run_page/garmin_cn_download.py --secret_string ${{ secrets.GARMIN_CN_SECRET_STRING }}
      #         ;;
      #       Nike_to_Strava)
      #         python3 run_page/nike_to_strava.py --nike_refresh_token ${{ secrets.NIKE_REFRESH_TOKEN }} \
      #           --strava_client_id ${{ secrets.STRAVA_CLIENT_ID }} \
      #           --strava_client_secret ${{ secrets.STRAVA_CLIENT_SECRET }} \
      #           --strava_refresh_token ${{ secrets.STRAVA_REFRESH_TOKEN }}
      #         ;;
      #       Keep)
      #         python3 run_page/keep_sync.py  ${{ secrets.KEEP_PHONE_NUMBER }} ${{ secrets.KEEP_PASSWORD }} --with-gpx
      #         ;;
      #       *)
      #         echo "âŒ ä¸æ”¯æŒçš„å¹³å°ç±»å‹ï¼š${APP_TYPE}"
      #         exit 1
      #         ;;
      #     esac
          
      #     # ç¬¬äºŒæ­¥ï¼šç”ŸæˆSVGå›¾ç‰‡ï¼ˆæ ¸å¿ƒå‘½ä»¤ï¼‰
      #     echo "ğŸ¨ å¼€å§‹ç”ŸæˆSVGå›¾ç‰‡"
      #     python3 run_page/gen_svg.py \
      #       --from-db \
      #       --title "${{ env.TITLE }}" \
      #       --type github \
      #       --athlete "${{ env.ATHLETE }}" \
      #       --special-distance 10 \
      #       --special-distance2 20 \
      #       --special-color yellow \
      #       --special-color2 red \
      #       --output assets/github.svg \
      #       --use-localtime \
      #       --min-distance 0.5
          
      #     # éªŒè¯SVGæ–‡ä»¶æ˜¯å¦ç”Ÿæˆ
      #     if [ ! -f assets/github.svg ]; then
      #       echo "âŒ SVGå›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œæœªæ‰¾åˆ°assets/github.svg"
      #       exit 1
      #     fi
      #     echo "âœ… SVGå›¾ç‰‡ç”ŸæˆæˆåŠŸï¼Œè·¯å¾„ï¼š${{ env.SRC_DIR }}/assets/github.svg"

      - name: è®¾ç½®Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          driver: docker-container
          driver-opts: network=host
          buildkitd-flags: --debug
          platforms: linux/amd64 # ä»…ä¿ç•™amd64æ¶æ„

      - name: æ„å»ºDockeré•œåƒ
        id: build-image
        run: |
          # è·å–æ„å»ºç±»å‹ï¼ˆæ‰‹åŠ¨è§¦å‘ä¼˜å…ˆï¼Œé»˜Keepï¼‰
          APP_TYPE="${{ github.event.inputs.app_type || 'Keep' }}"
          echo "ğŸ”¨ å¼€å§‹æ„å»º ${APP_TYPE} å¹³å°é•œåƒï¼Œæ¶æ„ï¼šlinux/amd64"
          
          # è¿›å…¥æºç ç›®å½•æ‰§è¡Œæ„å»º
          cd ${{ env.SRC_DIR }}
          
          # åˆå§‹åŒ–æ„å»ºå‚æ•°ï¼ˆä¿ç•™åŸé€»è¾‘ï¼Œç¡®ä¿é•œåƒå†…é…ç½®æ­£ç¡®ï¼‰
          BUILD_ARGS=""
          case $APP_TYPE in
            Strava)
              BUILD_ARGS="--build-arg app=Strava \
                --build-arg client_id=${{ secrets.STRAVA_CLIENT_ID }} \
                --build-arg client_secret=${{ secrets.STRAVA_CLIENT_SECRET }} \
                --build-arg refresh_token=${{ secrets.STRAVA_REFRESH_TOKEN }} \
                --build-arg YOUR_NAME=${{ secrets.MY_NAME }}"
              ;;
            NRC)
              BUILD_ARGS="--build-arg app=NRC \
                --build-arg nike_refresh_token=${{ secrets.NIKE_REFRESH_TOKEN }}"
              ;;
            Garmin)
              BUILD_ARGS="--build-arg app=Garmin \
                --build-arg secret_string=${{ secrets.GARMIN_SECRET_STRING }}"
              ;;
            Garmin-CN)
              BUILD_ARGS="--build-arg app=Garmin-CN \
                --build-arg secret_string=${{ secrets.GARMIN_CN_SECRET_STRING }}"
              ;;
            Nike_to_Strava)
              BUILD_ARGS="--build-arg app=Nike_to_Strava \
                --build-arg nike_refresh_token=${{ secrets.NIKE_REFRESH_TOKEN }} \
                --build-arg strava_client_id=${{ secrets.STRAVA_CLIENT_ID }} \
                --build-arg strava_client_secret=${{ secrets.STRAVA_CLIENT_SECRET }} \
                --build-arg strava_refresh_token=${{ secrets.STRAVA_REFRESH_TOKEN }}"
              ;;
            Keep)
              BUILD_ARGS="--build-arg app=Keep \
                --build-arg keep_phone_number=${{ secrets.KEEP_PHONE_NUMBER }} \
                --build-arg keep_password=${{ secrets.KEEP_PASSWORD }} \
                --build-arg YOUR_NAME=${{ secrets.MY_NAME }}"
              ;;
            *)
              echo "âŒ ä¸æ”¯æŒçš„å¹³å°ç±»å‹ï¼š${APP_TYPE}"
              exit 1
              ;;
          esac
          
          # æ„å»ºé•œåƒï¼ˆåŒ…å«ç”Ÿæˆçš„SVGæ–‡ä»¶ï¼‰ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„æ—¶é—´æˆ³
          docker buildx build -t running_page:${{ env.IMAGE_TAG_TIMESTAMP }} \
            --platform linux/amd64 \
            $BUILD_ARGS \
            --load .

      - name: ç™»å½•Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ env.DOCKERHUB_USERNAME }}
          password: ${{ env.DOCKERHUB_TOKEN }}
        if: success() && env.DOCKERHUB_USERNAME != '' && env.DOCKERHUB_TOKEN != ''

      - name: æ¨é€é•œåƒåˆ°Docker Hub
        run: |
          # å¼•ç”¨ç¯å¢ƒå˜é‡ä¸­çš„æ—¶é—´æˆ³
          TS=${{ env.IMAGE_TAG_TIMESTAMP }}
          APP_TYPE="${{ github.event.inputs.app_type || 'Keep' }}"
          TAG_LATEST="${{ env.DOCKERHUB_USERNAME }}/running_page:latest"
          TAG_APP="${{ env.DOCKERHUB_USERNAME }}/running_page:${APP_TYPE}-${TS}"
          
          echo "ğŸ“¤ æ¨é€é•œåƒåˆ° Docker Hubï¼š${TAG_LATEST}"
          docker tag running_page:${TS} $TAG_LATEST
          docker push $TAG_LATEST
          
          echo "ğŸ“¤ æ¨é€å¹³å°ä¸“å±é•œåƒï¼š${TAG_APP}"
          docker tag running_page:${TS} $TAG_APP
          docker push $TAG_APP
        if: success() && env.DOCKERHUB_USERNAME != '' && env.DOCKERHUB_TOKEN != ''

      - name: ç™»å½•GitHub Packages
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
        if: success()

      - name: æ¨é€é•œåƒåˆ°GitHub Packages
        run: |
          # å¼•ç”¨ç¯å¢ƒå˜é‡ä¸­çš„æ—¶é—´æˆ³
          TS=${{ env.IMAGE_TAG_TIMESTAMP }}
          APP_TYPE="${{ github.event.inputs.app_type || 'Keep' }}"
          TAG_LATEST="ghcr.io/${{ github.repository_owner }}/running_page:latest"
          TAG_APP="ghcr.io/${{ github.repository_owner }}/running_page:${APP_TYPE}-${TS}"
          
          echo "ğŸ“¤ æ¨é€é•œåƒåˆ° GitHub Packagesï¼š${TAG_LATEST}"
          docker tag running_page:${TS} $TAG_LATEST
          docker push $TAG_LATEST
          
          echo "ğŸ“¤ æ¨é€å¹³å°ä¸“å±é•œåƒï¼š${TAG_APP}"
          docker tag running_page:${TS} $TAG_APP
          docker push $TAG_APP
        if: success()
